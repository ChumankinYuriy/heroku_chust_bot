Репозиторий содержит два приложения:
* телеграм бот для выполнения переноса стиля
* скрипт для выполнения переноса стиля вручную

# Telegram бот для выполнения переноса стиля (@chustransfer_bot) 
**Профиль бота в telegram: @chustransfer_bot**

## Взаимодействие с ботом
Бот способен обрабатывать команды:
1. **/start** - отображение приветствия, справка;
1. **/справка** - отображение справки;
1. **/фото** - задание изображения с содержанием;
1. **/стиль** - задание изображения со стилем;
1. **/результат** - запуск обработки изображений;
1. **/покажи** - показать изображение;

### /start
Команда не имеет аргументов. В ответ на команду бот отправляет приветствие, справку. 

### /справка
Команда не имеет аргументов. В ответ на команду бот отправляет справку.

### /фото
Команда не имеет аргументов. В ответ на команду бот отправляет сообщение с просьбой
выслать ему изображение с содержанием.

К следующему сообщению пользователь должен прикрепить изображение.

### /стиль
Команда не имеет аргументов. В ответ на команду бот отправляет сообщение с просьбой
задать стиль. Задать стиль можно двумя способами.
1. Выбрать один из стандартных стилей. Для этого следующим сообщением пользователь 
высылает номер стандартного стиля (список есть в сообщении от бота).
1. Прислать своё изображение со стилем. 
Для этого пользователь прикрепляет изображение стиля к следующему сообщению. 

### /результат
Запуск переноса стиля. Предварительно необходимо задать изображения 
содержания и стиля (команды '/стиль' и '/фото').
В ответ бот высылает просьбу дождаться ожидания выполнения вычислений. 
После окончания вычислений бот высылает изображение с перенесённым стилем.

Во время вычислений бот на все команды и сообщения отвечает просьбой дождаться
окончания вычислений.

### /покажи
Отправка в ответ на команду изображения.
Команда имеет единственный аргумент - один из идентификаторов:
* **стиль** - текущий стиль;
* **фото** - текущее изображение содержания;
* **1 или 2 или 3** - один из стандартных стилей.

Список стандартных стилей можно просмотреть вызовом команды '/стиль'. 

## Запуск
Для запуска бота необходимо запустить на исполнение файл 'main.py'.

Входных параметров у скрипта нет, но для корректной работы неоходимо задать
несколько переменных окружения:
* TOKEN - токен для подключения к боту;
* PORT - порт на котором будут приниматься запросы от telegram;
* WEBHOOK_HOST - хост, который будет зарегистрирован как 
['webhook'](https://groosha.gitbook.io/telegram-bot-lessons/chapter4) для бота.
* IMSIZE (опционально) - выходной размер изображений, чем он больше, 
тем дольше выполняется обработка (значение по умолчанию 256).

## Особенности реализации
Взаимодействие с telegram происходит с использованием [aiogram](https://docs.aiogram.dev/en/latest/).
В основу разработки лёг репозиторий [deploy-your-bot-everywhere](https://github.com/deploy-your-bot-everywhere).
Взаимодействие происходит по сценарию ['webhook'](https://groosha.gitbook.io/telegram-bot-lessons/chapter4).

Перенос стиля выполняется по 
[классическому алгоритму](https://pytorch.org/tutorials/advanced/neural_style_tutorial.html)
с использованием библиотеки [pytorch](https://pytorch.org/).

Бот разработан с учётом того, что он будет запущен на платформе [heroku](https://dashboard.heroku.com/apps)
в бесплатном режиме.

# Скрипт для выполнения переноса стиля вручную

Скрипт написан для проверки работоспособности математической составляющей бота.

Для запуска необходимо запустить на исполнение файл 'core_test.py'.

Входных параметров у скрипта нет. Изображения стиля и содержания указываются
непосредственно в скрипте.

Примеры изображений стилей и содержаний для тестирования расположены в директориях
test_data и styles.

Для переноса стиля используется 
[классический алгоритм](https://pytorch.org/tutorials/advanced/neural_style_tutorial.html)
и библиотека [pytorch](https://pytorch.org/).

# Пояснения к содержимому репозитория
* styles - директория со стандартными изображениями стилей;
* test_data - директория с примерами изображений содержания;
* tmp - директория для хранения временных файлов;
* core.py - реализация методов и классов для выполнения переноса стиля;
* core_test.py - скрипт для выполнения переноса стиля вручную (вызывает core.py);
* main.py - скрипт с реализацией бота;
* Procfile - файл со строкой запуска для heroku;
* README.md - краткое описание проекта;
* requirements.txt - список зависимостей для heroku;
* runtime.txt - указание интерпретатора для heroku;
* utils.py - вспомогательные функции для работы бота.